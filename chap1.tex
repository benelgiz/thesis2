%% This is an example first chapter.  You should put chapter/appendix that you
%% write into a separate file, and add a line \include{yourfilename} to
%% main.tex, where `yourfilename.tex' is the name of the chapter/appendix file.
%% You can process specific files by typing their names in at the 
%% \files=
%% prompt when you run the file main.tex through LaTeX.

\chapter{Introduction}


Lately, the popularity and reachability of UAS have risen steeply thanks to the advancements in electronic components and yet the decrease in their cost. 
This accelerating trend towards small but capable flying vehicles is pushing the limits of both hardware and software potentials of industry and academia. 
This called the regulators to duty due to the concerns from the manned aviation community after incidences of drones flying close to civil aircrafts and airports. 
Increasing usage of these vehicles for a variety of missions pushes a further liability to secure the flight.
With the advent of the new era of UAS, different institutions all over the world, specifically National Aeronautics and Space Administration (NASA) 
\cite{kopardekarunmanned} and Federal Aviation Administration (FAA) \cite{FAA_UASintegration} in US, European Aviation Safety Agency (EASA) \cite{A_NPA_EASA2015} in Europe and international bases such as International Civil Aviation Organization (ICAO) \cite{ICAO_Circular} are addressing safe integration of UAS in airspace \cite{baskaya2016flexible}.
The U-Space concept in Europe (UTM in the US, which aims at enabling safe integration into airspace), gives the insight by showing in their roadmaps that level of drone automatization and level of drone connectivity (drone to drone and drone to infrastructure) will guide the pace of the U-Space services (U1 to U4) \cite{undertaking2017u}. 
These enablers will allow intelligent agents to share information and automate complex situations such as emergencies. 
Thus future aviation will inevitably go towards automatization. 
Here we propose a concept that will contribute to the automatization of drones, that will make them more intelligent and thus contribute to a safer integration of drones into airspace. 
These awareness abilities allow to mitigate risks in accordance with the risk assessment procedures offered by JARUS (SORA) \cite{SORA} defined by \cite{EASAopinion2018}. 
The abilities of a drone after an emergency should be assessed and depending on the availability of the environment, a recovery procedure might be initiated. 
For the cases that a recovery is not possible, safe ditching might be needed to reduce the harm in the air or on the ground. 
 

\section{Motivation}

Improvement of the reliability of the flight is considered to be one of the main goals for integrating UAVs into civil airspace according to Unmanned systems roadmap by US Office of the Secretary of Defense, DoD \cite{UnmannedSystemsRoadmapDoD}. 
To achieve a safe flight is not an easy task considering the unknowns of the systems' hardware, environment and possible system faults and failures to emerge. 
Also, increasing demand on cost effective systems, resulting in the smaller sensors and actuators with less accuracy, impose the software to achieve even more. 
The expectation that UAVs should be less expensive than their manned counterparts might have a hit on reliability of the system. Cost saving measures other than the need to support a pilot/crew onboard or decrement in size would probably lead to decrease in system reliability.

Under the research and development programs and initiatives identified by DoD in order to develop technologies and capabilities for UAS, the biggest chunk in control technologies is the health management and adaptive control with a budget of 74.3 M dollars. 
Other safety features such as validation and verification of flight critical intelligent software is the second with 57.8 M dollars \cite{UnmannedSystemsRoadmapDoD}. 

Systems are often susceptible to faults of different nature. Existing irregularities in sensors, actuators, or controller could be amplified due to the control system design and lead to failures. A fault could be hidden thanks to the control action \cite{ducard2009fault}.

The widely used method to increase reliability is to use more reliable components and/or hardware redundancy. Both requires an increase in the cost of the UAS, conflicting one of the main reasons of UAS' popularity\cite{angelov2012sense}. To offer solutions for all different foreseen categories of airspace, a variety of approaches should be considered. While hardware redundancy could cope with the failure situations of UAVs in the certified airspace, it may not be suitable for UAVs in open or some subsets of specific categories due to budget constraints. Analytical redundancy is another solution, may be not as effective and simple as hardware redundancy, but relies on the design of intelligent methods to utilize every bit of information on board aircraft wisely to deal with the instances.  

\section{Contribution}

Integration of drones into airspace needs the introduction of indigenous designs that will serve safe solutions for drones. This necessitates intelligent approaches to address the emergency situations. One of the aspects of the problem is to assure a safe flight by designing fault detection and diagnosis with cheaper avionics common in a vast number of drones.
The hardware limitations for these small vehicles point the utilization of \emph{analytical redundancy} rather than the usual practice of hardware redundancy in manned aviation. 
For that purpose, we introduce an end-to-end design to achieve data-driven fault diagnosis for control surface faults on drones.
In the course of this study, machine learning practices are implemented to diagnose faults on a small fixed-wing UAV to avoid the burden of accurate modeling needed in model-based fault diagnosis. 
This work aims to design a classifier via SVM to solve FDD for drones with actuator faults.
All data and the code available in code sharing and versioning system \emph{Github}. 

In this thesis, fault classification simulations are investigated under two main sections: classification of faults based on simulated flight measurements and classification of faults based on real flight data. 

For classification on data generated from simulations, model of a MAKO UAV is simulated.
Sensor measurements (accelerometer and gyro data) have been calculated using information of drone's motion and the specifications of the sensors. 
Generated data is usually more structured compared to the real flight data. 
In this preliminary application of SVM to fault diagnosis, we aimed to start with an easier problem, and used data generated from models.
There is no controller involved in the model in this preliminary application of SVM to detection in order to discard the controller's effect on the diagnosis. 
The results show that SVM classifier was very accurate and fast in diagnosing the fault on the control surfaces with a classification accuracy of $99.999\%$.

Accurate results on classification of faults with generated data encouraged us to go further and investigate fault detection with real flight data. 
Since SVM is a supervised classification method, labeled data is necessary to train the algorithm. For that reason, real flights have been arranged to generate faulty flight data by manipulating the open source autopilot \emph{Paparazzi}.  
The training is held offline due to the need for labeled data and computational burden of the tuning phase of the classifiers. 
Two types of faults have been mainly investigated, the control surface stuck and loss of effectiveness of the elevon. Results indicate that the control surface stuck can be detected relatively easily with 3 gyros and 3 accelerometers data compared to loss of effectiveness (efficiency). 
The results show that over the flight data, SVM yields an F1 score of 0.98 for classification of control surface stuck fault. 
Addition of features to accommodate previous measurements improve classification performance for tuned classifiers while the untuned classification performance deteriorates. 
Classification performs poorly for loss of efficiency faults especially for smaller ineffectiveness values. 
For the loss of efficiency fault, some feature engineering, involving the addition of past measurements is needed to attain the same classification performance.

A very promising result is discovered when \emph{spinors} are used as features instead of angular velocities. 
Result show that by using spinors for classification, there is a vast improvement in the classification accuracy especially when the classifiers are untuned. Using spinors and a Gaussian Kernel, untuned classifier gives f1Score of 0.9555 which is 0.2712 when gyro measurements are used as features.

In general, this work shows that SVM gives satisfactory performance for classification of faults on control surfaces of a drone using flight data.

\section{Thesis Outline}

\textbf{Chapter 1} starts with an introduction to the thesis. It is followed by the motivation and contribution. Then, the thesis outline is given.\\
\textbf{Chapter 2} presents the state of the art on topics: 
\begin{itemize}
\item{Integration of drones into airspace}
\item{Paparazzi Autopilot}
\item{Fault Tolerant Control Systems with a focus on Fault Detection and Diagnosis}
\item{Machine Learning and Artificial Intelligence in general}
\end{itemize}
Integration for drones into the airspace constitutes the motivation of this thesis. To assure a safe integration of drones into the airspace, design of vehicle health management systems is crucial. Fault detection and diagnosis plays an important role in vehicle health management, thus literature review of that topic is also presented in this chapter. In this thesis, the method selected to detect and diagnose faults is Support Vector Machines, which is a machine learning method. Thus, state of the art for machine learning is also given. \emph{Paparazzi} autopilot has been used to realize flights to generate faulty data, thus it is also introduced in this chapter.\\
\textbf{Chapter 3} focuses on equations of motion of an aircraft. In this chapter, equations for translational and rotational motion are discussed separately in detail. After the equations are derived for a generic aircraft, calculation of forces and moments which are specific to an individual drone is presented. Then, modeling accelerometer and gyro data is explained. Modeling faults in the control surfaces of an aircraft is also discussed in this chapter.\\
\textbf{Chapter 4} is dedicated to machine learning algorithms with a focus on their implementations. After the general practices of machine learning applications are presented, Support Vector Machines (SVM) is discussed in more detail since it is the selected method to classify the faults from nominal conditions.\\
\textbf{Chapter 5} focuses on the results of fault classification results under two main sections: classification of faults based on simulated  flight measurements and classification of faults based on real flight data. In the first part, flight data is simulated using the mathematical equations explained in Chapter 3. SVM algorithm is trained with the simulated data to classify the faulty and nominal phases of the simulated flight. The second part starts with explanations on faulty flight experiments realized. \emph{Paparazzi} Autopilot has been modified to introduce faults to control surfaces during the flight. Then, classification of control surface stuck and loss of effectiveness faults have been investigated separately.\\
\textbf{Chapter 6} concludes the thesis with an outlook on the contributions and results acquired during the thesis.